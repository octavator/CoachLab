var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}import Modal from'./modal.js';import Navbar from'./navbar.js';var Agenda=function(_React$Component){_inherits(Agenda,_React$Component);function Agenda(props){_classCallCheck(this,Agenda);var _this=_possibleConstructorReturn(this,(Agenda.__proto__||Object.getPrototypeOf(Agenda)).call(this,props));_this.state={show_schedule_modal:false,show_details_modal:false,schedule:{},currentDay:new Date,currentWeek:undefined,year:2021,showFlash:false,flashType:'',flashMessage:'',appointment_detailed:{},form:{duration:'30',isVideo:true,id:''},user:{firstname:'',lastname:''},weekdays:['Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi','Dimanche'],hours:['8','9','10','11','12','13','14','15','16','17','18','19','20','21'],monthdays:[31,28,31,30,31,30,31,31,30,31,30,31],months:['Janvier','F\xE9vrier','Mars','Avril','Mai','Juin','Juillet','Ao\xFBt','Septembre','Octobre','Novembre','D\xE9cembre']};return _this}_createClass(Agenda,[{key:'componentDidMount',value:function componentDidMount(){var _this2=this;http.get('/me').then(function(res){http.get('/me/agenda').then(function(agendaData){var curWeek=_this2.getCurrentWeek(_this2.state.currentDay);_this2.setState({currentWeek:curWeek,user:res.data,schedule:agendaData.data})})})}},{key:'addDays',value:function addDays(date,days){var result=new Date(date);result.setDate(result.getDate()+days);return result}},{key:'showNextWeek',value:function showNextWeek(){var new_day=this.addDays(this.state.currentDay,7);var new_week=this.getCurrentWeek(new_day);this.setState({currentDay:new_day,currentWeek:new_week})}},{key:'showPrevWeek',value:function showPrevWeek(){var new_day=this.addDays(this.state.currentDay,-7);var new_week=this.getCurrentWeek(new_day);this.setState({currentDay:new_day,currentWeek:new_week})}},{key:'getCurrentWeek',value:function getCurrentWeek(targetDay){var _this3=this;var dayIndex=targetDay.getDay()-1;dayIndex=dayIndex<0?6:dayIndex;return this.state.weekdays.map(function(_day,i){return _this3.addDays(targetDay,i-dayIndex)})}},{key:'showFlashMessage',value:function showFlashMessage(type,message){var _this4=this;this.setState({showFlash:true,flashMessage:message,flashType:type},function(){setTimeout(function(){_this4.setState({showFlash:false})},5000)})}},{key:'sendForm',value:function sendForm(){var _this5=this;http.post('/new-resa',{id:this.state.form.id,resa:this.state.form,email:this.state.user.email}).then(function(res){var schedule=_this5.state.schedule;schedule[_this5.state.form.id]=_this5.state.form;_this5.showFlashMessage('success','Votre rendez-vous a bien \xE9t\xE9 enregistr\xE9.');_this5.setState({schedule:schedule})}).catch(function(err){_this5.showFlashMessage('error',err.response.data||'Une erreur inattendue est survenue.')})}},{key:'buildResaId',value:function buildResaId(day,hour){if(!this.state.currentWeek)return'null';var weekIdx=this.state.weekdays.indexOf(day);var date=this.state.currentWeek[weekIdx];date.setHours(hour,0,0);return date.toLocaleString()}},{key:'render',value:function render(){var _this6=this;var detailsForm=[React.createElement('div',{key:'duration',className:'details-duration-section'},React.createElement('div',{className:'details-duration-label'},'Dur\xE9e:'),React.createElement('div',{className:'details-duration-value'},this.state.appointment_detailed.duration)),React.createElement('div',{key:'isVideo',className:'details-isVideo-section'},React.createElement('div',{className:'details-isVideo-label'},'Visio-conf\xE9rence:'),React.createElement('div',{className:'details-isVideo-value'},this.state.appointment_detailed.isVideo?'Oui':'Non')),React.createElement('div',{key:'visioLink',className:'details-visioLink-section'+(this.state.appointment_detailed.isVideo?'':' hidden')},React.createElement('div',{className:'details-visioLink-label'},'Lien de la visio-conf\xE9rence:'),React.createElement('div',{className:'details-visioLink-value'},this.state.appointment_detailed.isVideo?'http://superlienvideo.caramel':''))];var scheduleForm=[React.createElement('div',{key:'duration',className:'input-group select-input'},React.createElement('label',{className:'input-label'},'Dur\xE9e'),React.createElement('select',{onChange:function onChange(e){_this6.setState({form:Object.assign({},_this6.state.form,{duration:e.target.value})})},name:'duration',className:'infos-form-select duration-select'},React.createElement('option',{value:'30'},'30min'),React.createElement('option',{value:'45'},'45min'),React.createElement('option',{value:'60'},'1h'))),React.createElement('div',{key:'isVideo',className:'input-group radio-group'},React.createElement('label',{className:'input-label'},'Visio-conf\xE9rence'),React.createElement('div',{className:'radio-choices',onChange:function onChange(e){_this6.setState({form:Object.assign({},_this6.state.form,{isVideo:e.target.value})})}},React.createElement('label',{className:'radio-label',htmlFor:'isVideo'},'Oui'),React.createElement('input',{type:'radio',defaultChecked:true,value:true,id:'isVideo',name:'isVideo',className:'cl-radio'}),React.createElement('label',{className:'radio-label',htmlFor:'isNotVideo'},'Non'),React.createElement('input',{id:'isNotVideo',value:false,name:'isVideo',type:'radio',className:'cl-radio'}))),React.createElement('div',{key:'sendbtn',className:'input-group'},React.createElement('div',{className:'button-group'},React.createElement('button',{onClick:function onClick(){_this6.sendForm();_this6.setState({show_schedule_modal:false})},className:'cl-button primary'},'Valider')))];var cellClass='schedule-cell-content ';var firstDate=this.state.currentWeek?this.state.currentWeek[0].getDate():'';var lastDate=this.state.currentWeek?this.state.currentWeek[6].getDate():'';var lastDateMonth=this.state.currentWeek?this.state.currentWeek[6].getMonth():'';var lastDateYear=this.state.currentWeek?this.state.currentWeek[6].getFullYear():'';return React.createElement('div',null,React.createElement(Navbar,{user:this.state.user}),React.createElement('div',{className:'agenda-wrapper'},React.createElement('div',{className:'flash-message'+(this.state.showFlash?' '+this.state.flashType:' hidden')},this.state.flashMessage),React.createElement('h1',{className:'page-title'},'Agenda de\xA0',React.createElement('span',{className:'agenda-name'},this.state.user.firstname+' '+this.state.user.lastname)),React.createElement('h2',{className:'page-title'},'Semaine du ',firstDate,' au ',lastDate,' ',this.state.months[lastDateMonth],' ',lastDateYear),React.createElement('div',{className:'week-selectors'},React.createElement('div',{onClick:function onClick(){_this6.showPrevWeek()},className:'previous-week'},'<\xA0Semaine pr\xE9c\xE9dente'),React.createElement('div',{onClick:function onClick(){_this6.showNextWeek()},className:'next-week'},'Semaine suivante\xA0>')),React.createElement(Modal,{toggle:this.state.show_schedule_modal,closeFunc:function closeFunc(){_this6.setState({show_schedule_modal:false})},fields:scheduleForm,title:'Prendre un RDV',id:'appointment'}),React.createElement(Modal,{toggle:this.state.show_details_modal,closeFunc:function closeFunc(){_this6.setState({show_details_modal:false})},fields:detailsForm,title:'Votre RDV',id:'appointment-details'}),React.createElement('div',{className:'agenda-header'},React.createElement('div',{className:'agenda-header-section hour-column'}),this.state.weekdays.map(function(day){return React.createElement('div',{key:day,className:'agenda-header-section'},day)})),React.createElement('div',{className:'agenda-content-wrapper'},React.createElement('div',{className:'agenda-content-column hour-column'},this.state.hours.map(function(hour){return React.createElement('div',{key:hour,className:'hour-cell'},hour,'h\xA0')})),this.state.weekdays.map(function(day){return React.createElement('div',{key:day,className:'agenda-content-column'},_this6.state.hours.map(function(hour){var slot_id=_this6.buildResaId(day,hour);var slot=_this6.state.schedule[slot_id];return React.createElement('div',{key:hour,className:'schedule-cell'},React.createElement('div',{onClick:function onClick(){!slot?_this6.setState({show_schedule_modal:true,form:Object.assign({},_this6.state.form,{id:slot_id})}):_this6.setState({show_details_modal:true,appointment_detailed:slot})},className:!slot&&cellClass+' empty'||cellClass},slot?'RDV de '+slot.duration+'min '+(['true',true].includes(slot.isVideo)?'avec':'sans')+' visio-conf\xE9rence':'+'))}))}))))}}]);return Agenda}(React.Component);var domContainer=document.querySelector('.agenda-wrapper');ReactDOM.render(React.createElement(Agenda,null),domContainer);