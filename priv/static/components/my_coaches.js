var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}import Navbar from'./navbar.js';import{TextInput,Button}from'./forms/inputs.js';var MyCoaches=function(_React$Component){_inherits(MyCoaches,_React$Component);function MyCoaches(props){_classCallCheck(this,MyCoaches);var _this=_possibleConstructorReturn(this,(MyCoaches.__proto__||Object.getPrototypeOf(MyCoaches)).call(this,props));_this.state={user:{firstname:'',lastname:'',role:'coach'},showFlash:false,flashType:'',flashMessage:'',coaches:[],search_coaches:[],search_coach_name:'',show_coaches:false,new_coach_id:''};return _this}_createClass(MyCoaches,[{key:'componentDidMount',value:function componentDidMount(){var _this2=this;http.get('/me').then(function(userData){http.get('/api/linked_users').then(function(myCoaches){_this2.setState({user:userData.data,coaches:myCoaches.data})}).catch(function(err){_this2.showFlashMessage('error',err.response.data||'Une erreur inattendue est survenue.')})}).catch(function(err){_this2.showFlashMessage('error',err.response.data||'Une erreur inattendue est survenue.')})}},{key:'showFlashMessage',value:function showFlashMessage(type,message){var _this3=this;this.setState({showFlash:true,flashMessage:message,flashType:type},function(){setTimeout(function(){_this3.setState({showFlash:false})},5000)})}},{key:'getImageExt',value:function getImageExt(filepath){if(!filepath)return'';var tokens=filepath.split('.');return tokens[tokens.length-1]}},{key:'addChosenCoach',value:function addChosenCoach(){var _this4=this;if(this.state.new_coach_id=='')return;http.post('/new_coach',{coach_id:this.state.new_coach_id}).then(function(res){res.statuts==200?_this4.showFlashMessage('success','Votre coach a bien \xE9t\xE9 rajout\xE9. Rafraichissez la page.'):_this4.showFlashMessage('error','Une erreur est survenue lors de l\'ajout de votre coach.')})}},{key:'getMatchingCoaches',value:function getMatchingCoaches(input){var _this5=this;if(input.length>=3){http.get('/coach/search?coach_name='+encodeURIComponent(input)).then(function(res){res.status==200?_this5.setState({search_coaches:res.data,show_coaches:res.data.length>0}):_this5.showFlashMessage('error','Une erreur est survenue lors de la recherche.')}).catch(function(err){_this5.showFlashMessage('error',err.response.data||'Une erreur inattendue est survenue.')})}this.setState({search_coach_name:input})}},{key:'render',value:function render(){var _this6=this;return React.createElement('div',null,React.createElement(Navbar,{blue_bg:true,user:this.state.user}),React.createElement('div',{className:'flash-message text-3 '+(this.state.showFlash?' '+this.state.flashType:' hidden')},this.state.flashMessage),React.createElement('div',{className:'coach-list'},React.createElement('h1',{className:'page-title text-1'},this.state.user.role=='coach'?'Vos coach\xE9s':'Vos coachs'),React.createElement('div',{className:'coach-list-wrapper'},this.state.coaches.map(function(coach,idx){return React.createElement('div',{key:idx,onClick:function onClick(){window.location.href='/agenda?target_id='+coach.id},className:'coach-list-row'},React.createElement('div',{className:'coach-list-avatar'},React.createElement('img',{className:'round-avatar',onError:function onError(_ref){var currentTarget=_ref.currentTarget;currentTarget.onerror=null;// prevents looping
currentTarget.src='priv/static/images/avatar_placeholder.png'},src:'priv/static/images/'+coach.id+'/avatar.'+_this6.getImageExt(coach.avatar)})),React.createElement('div',{className:'coach-list-name text-2'},coach.firstname+' '+coach.lastname))})),React.createElement('div',{className:'add-coach-section '+(this.state.user.role=='coach'?'hidden':'')},React.createElement('h2',{className:'centered-text mt-2'},'Ajoutez un coach'),React.createElement('div',{className:'flex input-group inline'},React.createElement('div',{className:'select-input-autocomplete-container mr-2'},React.createElement(TextInput,{extraClass:'text-3 autocomplete-text-input white-bg',value:this.state.search_coach_name,placeholder:'Nom du coach',onChange:function onChange(e){_this6.getMatchingCoaches(e)}}),React.createElement('div',{className:'select-autocomplete-wrapper'+(this.state.show_coaches?'':' hidden')},this.state.search_coaches.map(function(coach){return React.createElement('div',{key:coach.id,className:'select-autocomplete-option text-3',onClick:function onClick(){_this6.setState({search_coach_name:coach.firstname+' '+coach.lastname,new_coach_id:coach.id,show_coaches:false})}},coach.firstname+' '+coach.lastname)}))),React.createElement(Button,{extraClass:'cl-button white-bg text-3',onClick:function onClick(){_this6.addChosenCoach()},text:'Ajouter'})))))}}]);return MyCoaches}(React.Component);var domContainer=document.querySelector('.page-wrapper');ReactDOM.render(React.createElement(MyCoaches,null),domContainer);