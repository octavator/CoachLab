var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}import{TextInput,FileInput,TextArea,Button}from"../../forms/inputs.js";import Stepper from"../stepper.js";var DefaultThirdStep=function(_React$Component){_inherits(DefaultThirdStep,_React$Component);function DefaultThirdStep(props){_classCallCheck(this,DefaultThirdStep);var _this=_possibleConstructorReturn(this,(DefaultThirdStep.__proto__||Object.getPrototypeOf(DefaultThirdStep)).call(this,props));_this.state={form:{specialties:[]},filenames:{}};return _this}_createClass(DefaultThirdStep,[{key:"uploadFile",value:function uploadFile(key,e){var _this2=this;var formData=new FormData;var new_filenames=Object.assign({},this.state.filenames);var new_form=Object.assign({},this.state.form);var filename=(key+"_"+this.props.user_form.lastname+"_"+e.name).replace(" ","-");new_filenames[key]=filename;formData.append("myFile",e,filename);new_form[key]=filename;fetch("/inscription/file",{body:formData,method:"POST"}).then(function(res){if(res.status==200)_this2.setState({filenames:new_filenames,form:new_form});else _this2.props.showFlashMessage("error","Une erreur est survenue lors de l'envoi de votre fichier.")}).catch(function(e){_this2.props.showFlashMessage("error","Une erreur est survenue lors du t\xE9l\xE9chargement")})}},{key:"updateSpecialty",value:function updateSpecialty(value,index){var new_specialties=this.state.form.specialties;new_specialties[index]=value;this.setState({form:Object.assign({},this.state.form,{specialties:new_specialties})})}},{key:"validate",value:function validate(){var _this3=this;var required_keys=[];var isValid=required_keys.every(function(key){return _this3.state.form[key]!=undefined})&&this.state.form.specialties.length>0;if(!isValid)this.props.showFlashMessage("error","Veuillez renseigner tous les champs");return isValid}},{key:"sendForm",value:function sendForm(){if(this.validate()){this.props.update_form(this.state.form,true)}}},{key:"render",value:function render(){var _this4=this;return React.createElement("div",{className:"step-wrapper"},React.createElement("div",{className:"first-step-wrapper"},React.createElement("form",{className:"step-form",onSubmit:function onSubmit(e){e.preventDefault()}},React.createElement("div",{className:"step-sections-wrapper"},React.createElement("div",{className:"step-section-wrapper "},React.createElement("div",{className:"step-section-label text-2"},"Quelles sont vos sp\xE9cialit\xE9s ?"),React.createElement(TextInput,{extraClass:"cl-form-input  text-3",required:true,value:this.state.form.specialties[0],onChange:function onChange(e){_this4.updateSpecialty(e,0)},name:"specialties_0",placeholder:""}),React.createElement(TextInput,{extraClass:"cl-form-input  text-3",required:false,value:this.state.form.specialties[1],onChange:function onChange(e){_this4.updateSpecialty(e,1)},name:"specialties_1",placeholder:""}),React.createElement(TextInput,{extraClass:"cl-form-input  text-3",required:false,value:this.state.form.specialties[2],onChange:function onChange(e){_this4.updateSpecialty(e,2)},name:"specialties_2",placeholder:""}),React.createElement(TextInput,{extraClass:"cl-form-input  text-3",required:false,value:this.state.form.specialties[3],onChange:function onChange(e){_this4.updateSpecialty(e,3)},name:"specialties_3",placeholder:""})),React.createElement("div",{className:"step-section-wrapper"},React.createElement("div",{className:"step-section-label text-2"},"Merci de t\xE9l\xE9charger votre dipl\xF4me,",React.createElement("br",null)," certification et/ou tout document",React.createElement("br",null)," attestant de votre autorisation",React.createElement("br",null)," \xE0 pratiquer"),React.createElement(FileInput,{accept:".png,.jpeg,.jpg,.pdf",text:"Parcourir...",filename:this.state.filenames["certification"]&&this.state.filenames.certification.split("_").pop(),onChange:function onChange(e){return _this4.uploadFile("certification",e)},extraClass:"bg-white  text-3"})),React.createElement("div",{className:"step-section-wrapper"},React.createElement("div",{className:"step-section-label  text-2"},"Merci de t\xE9l\xE9charger une photo professionnelle"),React.createElement(FileInput,{accept:".png,.jpeg,.jpg,.pdf",text:"Parcourir...",filename:this.state.filenames["avatar"]&&this.state.filenames.avatar.split("_").pop(),onChange:function onChange(e){return _this4.uploadFile("avatar",e)},extraClass:"bg-white  text-3"}))),React.createElement("div",{className:"step-sections-wrapper"},React.createElement("div",{className:"step-section-wrapper"},React.createElement("div",{className:"step-section-label  text-2"},"Pr\xE9sentez-vous bri\xE8vement ",React.createElement("span",{className:""},"(100 caract\xE8res maximum)")),React.createElement(TextArea,{value:this.state.form.desc,maxlength:100,onChange:function onChange(value){_this4.setState({form:Object.assign({},_this4.state.form,{desc:value})})}})),React.createElement("div",{className:"step-section-wrapper"},React.createElement("div",{className:"step-section-label  text-2"},"Merci de t\xE9l\xE9charger une copie de votre RIB"),React.createElement(FileInput,{accept:".png,.jpeg,.jpg,.pdf",text:"Parcourir...",filename:this.state.filenames["rib"]&&this.state.filenames.rib.split("_").pop(),onChange:function onChange(e){return _this4.uploadFile("rib",e)},extraClass:"bg-white  text-3"}))),React.createElement(Button,{extraClass:"cl-button cl-form-button bg-white  text-3 hidden",onClick:function onClick(){_this4.sendForm()},text:"Suivant"})),React.createElement(Button,{extraClass:"cl-button cl-form-button bg-white  text-3",onClick:function onClick(){_this4.sendForm()},text:"Suivant"})),React.createElement(Stepper,{step:"3"}))}}]);return DefaultThirdStep}(React.Component);export default DefaultThirdStep;