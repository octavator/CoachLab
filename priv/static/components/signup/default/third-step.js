var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}import Stepper from"../stepper.js";import{FileInput,TextInput,TextArea,Button}from"../../forms/inputs.js";var DefaultThirdStep=function(_React$Component){_inherits(DefaultThirdStep,_React$Component);function DefaultThirdStep(props){_classCallCheck(this,DefaultThirdStep);var _this=_possibleConstructorReturn(this,(DefaultThirdStep.__proto__||Object.getPrototypeOf(DefaultThirdStep)).call(this,props));_this.state={form:{},filename:"",coaches:[],show_coaches:false,search_coach_name:"",flashMessage:"",flashType:"",showFlash:false};return _this}_createClass(DefaultThirdStep,[{key:"showFlashMessage",value:function showFlashMessage(type,message){var _this2=this;this.setState({showFlash:true,flashMessage:message,flashType:type},function(){setTimeout(function(){_this2.setState({showFlash:false})},5000)})}},{key:"getMatchingCoaches",value:function getMatchingCoaches(input){var _this3=this;if(input.length>=3){http.get("/coach/search?coach_name="+encodeURIComponent(input)).then(function(res){console.log(res.status);console.log(res.data);if(res.data.length>0)_this3.setState({coaches:res.data,show_coaches:true})}).catch(function(err){console.log(err.response);_this3.showFlashMessage("error",err.response.data||"Une erreur inattendue est survenue.")})}this.setState({search_coach_name:input})}},{key:"uploadFile",value:function uploadFile(e){var _this4=this;console.log(e);var formData=new FormData;var filename=("avatar_"+this.props.user_form.lastname+"_"+e.name).replace(" ","-");formData.append("myFile",e,filename);http.post("/inscription/file",formData).then(function(res){if(res.status==200)_this4.setState({filename:filename,form:Object.assign({},_this4.state.form,{avatar:filename})})})}},{key:"validate",value:function validate(){var isValid=this.state.filename&&(this.state.form.coaches||this.state.form.coach_desc);if(!isValid)this.props.showFlashMessage("error","Veuillez t\xE9l\xE9charger une photo, et choisir un coach ou pr\xE9ciser votre besoin");return isValid}},{key:"sendForm",value:function sendForm(){if(this.validate()){this.props.update_form(this.state.form,true)}}},{key:"render",value:function render(){var _this5=this;return React.createElement("div",{className:"step-wrapper"},React.createElement("div",{className:"step-title text-2"},"Recherchez-vous un coach en particulier ?"),React.createElement("div",{className:"default-choices-container"},React.createElement("div",{className:"default-choice-container"},React.createElement("div",{className:"default-choice-label default-choice-label-yes text-2"},"Oui"),React.createElement("div",{className:"select-input-autocomplete-container"},React.createElement(TextInput,{extraClass:"text-3 autocomplete-text-input",required:true,value:this.state.search_coach_name,placeholder:"Nom du coach",onChange:function onChange(e){_this5.getMatchingCoaches(e)}}),React.createElement("div",{className:"select-autocomplete-wrapper"+(this.state.show_coaches?"":" hidden")},this.state.coaches.map(function(coach){return React.createElement("div",{className:"select-autocomplete-option text-3",onClick:function onClick(){_this5.setState({search_coach_name:coach.firstname+" "+coach.lastname,form:Object.assign({},_this5.state.form,{coaches:[coach.id]}),show_coaches:false})}},coach.firstname+" "+coach.lastname)})))),React.createElement("div",{className:"default-choice-container"},React.createElement("div",{className:"default-choice-label default-choice-label-no text-2"},"Non"),React.createElement(TextArea,{extraClass:"text-3 ",placeholder:"Que recherchez-vous ? (100 caract\xE8res maximum)",onChange:function onChange(value){_this5.setState({form:Object.assign({},_this5.state.form,{coach_desc:value})})},value:this.state.form.coach_desc,rows:"10"}),React.createElement("div",{className:"default-choice-no-description text-4"},"Nous nous engageons \xE0 vous recontacter pour vous proposer les coachs certifi\xE9s les plus adapt\xE9s \xE0 votre demande",React.createElement("br",null),React.createElement("span",{className:"default-choice-description-legend"},"(48h maximum par t\xE9l\xE9phone)")))),React.createElement("div",{className:"picture-upload-container"},React.createElement("div",{className:"file-upload-container"},React.createElement(FileInput,{accept:".png,.jpeg,.jpg",text:"Parcourir...",filename:this.state.filename&&this.state.filename.split("_").pop(),onChange:function onChange(e){return _this5.uploadFile(e)},extraClass:"text-3 bg-white",label:"Merci de t\xE9l\xE9charger une photo de vous"}))),React.createElement("div",{className:"page-button-container"},React.createElement(Button,{text:"Suivant",onClick:function onClick(){_this5.sendForm()},extraClass:"text-3 cl-button cl-form-button bg-white"})),React.createElement(Stepper,{step:"3"}))}}]);return DefaultThirdStep}(React.Component);export default DefaultThirdStep;